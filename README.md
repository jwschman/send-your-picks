# Send Your Picks

NFL picks-against-the-spread tracking application. Run a pick pool with friends: set spreads, submit picks, and track standings across seasons.

> **This README.md is still a work in progress**

**Features:**
- Season and week management with a *mostly* automated progression workflow
- Commissioner tools for setting spreads and activating weeks
- Automated game matchup and score imports and pick result calculations
- Season standings, weekly rankings, and badge/achievement system
- Role-based access (user, commissioner, admin)

## Tech Stack

| Layer | Technology |
|-------|-----------|
| Backend | Go 1.24, Gin framework, sqlx |
| Frontend | SvelteKit 2, Svelte 5, TypeScript |
| Database | PostgreSQL via Supabase |
| Auth | Supabase JWT tokens |
| Game Data | BallDontLie API |
| Spreads | The Odds API |
| Deployment | Kubernetes |

## Project Structure

```
├── app/
│   ├── cmd/                  # Go entrypoints (server, admin bootstrap)
│   ├── internal/             # Backend packages
│   │   ├── api/              # Router, handlers, middleware
│   │   ├── service/          # Business logic, state machine
│   │   ├── models/           # Data structures
│   │   ├── external/         # External API clients (BallDontLie, Odds)
│   │   ├── db/               # Database connection
│   │   ├── settings/         # Global settings from DB
│   │   ├── logger/           # Structured logging (slog)
│   │   └── id/               # ULID generation
│   ├── frontend/             # SvelteKit app (see app/frontend/README.md)
│   └── Dockerfile
├── supabase/                 # Database migrations (and legacy local Supabase config)
├── k8s/                      # Kubernetes deployment manifests
└── reverse-proxy/            # Example Nginx config (for self-hosting)
```

See [`app/frontend/README.md`](app/frontend/README.md) for detailed frontend documentation (generated by Claude code).
See [`route-structure.md`](route-structure.md) for the full API and frontend route list.

## Getting Started

For local development, the backend and frontend run directly on the host. Production uses container images deployed to Kubernetes (container images are not yet publicly available).  You will also need a Supabase instance with the migrations found in `supabase/migrations` applied

### Prerequisites

- Go 1.24+
- Node.js / npm
- A [Supabase](https://supabase.com/) project (or self-hosted instance)
- A [BallDontLie](https://www.balldontlie.io/) API key
- A [The Odds API](https://the-odds-api.com/) key

### Backend

```bash
cd app
go run ./cmd/server/main.go
```

### Frontend

```bash
cd app/frontend
npm install
npm run dev       # Dev server
npm run build     # Production build
npm run check     # TypeScript/Svelte type checking
```

## Environment Variables

All configuration lives in a single `.env` file at the repo root. Copy `.env.example` to `.env` and fill in your values.

### Backend

| Variable | Description |
|----------|-------------|
| `HTTP_ADDR` | Listen address (default `:8080`) |
| `GIN_MODE` | Gin mode (`debug`/`release`) |
| `SITE_ADDRESS` | Frontend URL (for CORS) |
| `LOG_LEVEL` | `DEBUG`, `INFO`, `WARN`, `ERROR` |
| `SUPABASE_BASE_URL` | Supabase instance URL |
| `SUPABASE_STORAGE_URL` | Supabase storage URL |
| `SUPABASE_JWT_ISSUER` | JWT issuer URL |
| `SUPABASE_JWKS_URL` | JWKS endpoint for public keys |
| `DATABASE_URL` | PostgreSQL connection string |
| `EXTERNAL_API_BASE_URL` | BallDontLie API URL |
| `EXTERNAL_API_KEY` | BallDontLie API key |
| `ODDS_API_BASE_URL` | The Odds API URL |
| `ODDS_API_KEY` | The Odds API key |

### Frontend

| Variable | Description |
|----------|-------------|
| `PUBLIC_SUPABASE_URL` | Supabase instance URL |
| `PUBLIC_SUPABASE_PUBLISHABLE_KEY` | Supabase public/anon key |
| `PUBLIC_API_BASE_URL` | Backend API URL |
| `PUBLIC_APP_NAME` | Display name (defaults to "Send Your Picks") |

## Week State Machine

Weeks progress through 8 states with a mix of automated and manual transitions:

```
draft → games_imported → spreads_set → active → played → picks_results_calculated → scored → final
```

| Transition | Type | Description |
|-----------|------|-------------|
| draft → games_imported | Automated | Imports games from BallDontLie API |
| games_imported → spreads_set | Manual | Commissioner sets spreads |
| spreads_set → active | Manual | Commissioner activates week for picks |
| active → played | Automated | Imports scores, waits for all games to be final |
| played → picks_results_calculated | Automated | Determines pick correctness |
| picks_results_calculated → scored | Automated | Calculates weekly points and rankings |
| scored → final | Automated | Calculates season standings snapshot |

The state machine lives in `app/internal/service/statemachine.go`.

## Deployment

Production runs on Kubernetes. See [`k8s/readme.md`](k8s/readme.md) for manifests and configuration.

